<!DOCTYPE html>
<html lang="zh-cmn-Hans">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="renderer" content="webkit">
    <meta name="author" content="Heanes heanes.com email(heanes@163.com)">
    <meta name="keywords" content="软件,商务,HTML,tutorials,source codes">
    <meta name="description" content="描述">
    <link rel="stylesheet" type="text/css" href="../src/css/treeView.css"/>
    <link rel="stylesheet" type="text/css" href="../demo/css/demo.css"/>
    <link rel="stylesheet" type="text/css" href="../vendor/fonts/font-awesome/4.7.0/css/font-awesome.min.css"/>
    <title>treeView Demo</title>
</head>
<body>
<div class="wrap">
    <!--<div id="test1">fdasfdsfd</div>
    <div id="test2">fdasfdsfd</div>-->
    <div class="tree-top">
        <!--<div class="tree-top-wrap">
            <ul class="tree-top-list">
                <li class="tree-node active" data-nodeid="0">
                    <a class="node-wrap" href="">
                        <i class="icon node-icon fa fa-list"></i>
                        <span class="node-text">父菜单1</span>
                    </a>
                </li>
                <li class="tree-node" data-nodeid="6">
                    <a class="node-wrap" href="">
                        <i class="icon node-icon fa fa-list"></i>
                        <span class="node-text">父菜单2</span>
                    </a>
                </li>
            </ul>
        </div>-->
    </div>
    <div class="tree-left">
        <div class="tree-search">
            <input type="text" placeholder="输入可以搜索菜单节点" />
        </div>
        <!--<div class="tree-list-lap">
            <a href="javascript:" class="lap-handle" id="lapHandle" title="收缩/展开">
                <i class="fa fa-exchange" aria-hidden="true"></i>
            </a>
        </div>
        <div class="tree-list-wrap switch">
            <ul class="tree-group active">
                <li class="tree-node" data-nodeid="1">
                    <a class="node-wrap" href="b.html">
                        <i class="icon node-icon fa fa-edit"></i>
                        <span class="node-text">子菜单1.1</span>
                    </a>
                </li>
                <li class="tree-node" data-nodeid="2">
                    <a class="node-wrap" href="b.html">
                        <i class="icon node-collapse-expand-icon triangle-down"></i>
                        <i class="icon node-icon fa fa-list"></i>
                        <span class="node-text">子菜单1.2</span></a>
                        <ul class="tree-group">
                            <li class="tree-node" data-nodeid="3">
                                <a class="node-wrap" href="b.html">
                                    <span class="indent"></span>
                                    <i class="icon node-icon fa fa-list"></i>
                                    <span class="node-text">子菜单1.2.1</span>
                                </a>
                            </li>
                        </ul>
                </li>
                <li class="tree-node" data-nodeid="4">
                    <a class="node-wrap" href="b.html">
                        <i class="icon node-collapse-expand-icon triangle-down"></i>
                        <i class="icon node-icon fa fa-list"></i>
                        <span class="node-text">子菜单1.3</span>
                    </a>
                    <ul class="tree-group">
                        <li class="tree-node" data-nodeid="5">
                            <a class="node-wrap" href="b.html">
                                <span class="indent"></span>
                                <i class="icon node-icon fa fa-list"></i>
                                <span class="node-text">子菜单1.3.1</span>
                            </a>
                        </li>
                    </ul>
                </li>
            </ul>
            <ul class="tree-group">
                <li class="tree-node" data-nodeid="7">
                    <a class="node-wrap" href="b.html">
                        <i class="icon node-icon fa fa-list"></i>
                        <span class="node-text">子菜单2.1</span>
                    </a>
                </li>
                <li class="tree-node" data-nodeid="8">
                    <a class="node-wrap" href="b.html">
                        <i class="icon node-icon fa fa-list"></i>
                        <span class="node-text">子菜单2.2</span>
                    </a>
                </li>
            </ul>
        </div>-->
    </div>
</div>
<script type="text/javascript" src="../vendor/js/jquery/2.2.4/jquery.2.2.4.min.js"></script>
<script type="text/javascript" src="../src/js/treeView.js"></script>
<script type="text/javascript" src="../demo/data/treeData.js"></script>
<script type="text/javascript" src="../demo/data/treeDataSimple.js"></script>
<script type="text/javascript" src="../demo/js/demo.js"></script>
<script>
    $(function () {
        $('#abc').on('click', function (e, arg1, arg2) {
            console.log(arg1);
            console.log(arg2);
        });
        $('#abc').trigger('click', [{a: 'a'}, {b: 'b'}]);

        var currentSystemKey = 'wms-web';
        var authUrlsLibMap = {};
        var authDataJsonUrl = 'data/auth.json';
        
        function getAuthUrlsLibMap(authUrlsLib) {
            var authUrlsLibMap = [];
            $.each(authUrlsLib, function (i, item) {
                item['entry'] = item['entry'].replace(/_mc$/, '.mc');
                authUrlsLibMap[item['entry']] = item;
            });
            return authUrlsLibMap;
        }
        
        /*$.getJSON(authDataJsonUrl, function(result){
            authUrlsLibMap['_currentSystem'] = getAuthUrlsLibMap(result);

            var menuDataJsonUrl = 'data/tree.json';
            $.getJSON(menuDataJsonUrl, function(result){
                console.log(result);
                var treeList = [];
                convertTreeData(result.nodes, treeList, authUrlsLibMap, systemHosts);

                treeList = convertMenuToTree(result);
                console.log(JSON.stringify(treeList));
                console.log(treeList);

                $('.tree-left').treeView({
                    data: result, // treeData From treeData.js
                    iconCollapse: 'triangle-right',         // 合上时的图标
                    iconExpand: 'triangle-down',            // 展开时的图标
                    enableLink: true,                       // 开启链接
                    enableTopSwitch: true,                  // 开启顶部切换标识
                    enableIndentLeft: true,                 // 允许向左缩进
                    enableTreeSearch: true,                 // 开启树菜单搜索
                    treeSearchPlaceholder: '搜索(名称及链接)',// 树菜单搜索的提示字符
                    showTopNavIcon: false,                  // 顶部导航是否显示图标
                    showSingleNodeIcon: false,              // 无子树节点是否显示图标
                    topSwitcherTarget: $('.tree-top'),      // 开启了顶部切换后，根节点展示在此处，根节点展示在此处(填写jQuery Dom)

                    onNodeClick: function (event, node, $nodeDom) {
                        if(node.target && node.target === '_blank'){
                            window.open(node.href);
                            return false;
                        }
                        console.log('节点被点击：');
                        console.log(node);
                    },
                    onTopSwitch: function (event) {
                        console.log('顶部被点击，左侧会切换');
                    },
                    onTreeIndentLeft: function (event) {
                        console.log('左侧树缩进');
                    },    // 树向左边缩进事件
                });
            });
        });

        var dmsWebUrl = "<%=dmsWebUrl %>";
        var pmsUri="http://pms.cx.test.yunshanmeicai.com";
        var wmsCenterUri = "<%=wmsCenterUri %>";
        var wmsMonitorUri = "<%=wmsMonitorUri%>";
        var omcUri = "<%=omcUri%>";
        var wmsInbound = "<%=wmsInbound%>";
        var wmsBounding = "<%=wmsBounding%>";


        var systemHosts = {
            'pms'           : 'http://pms.cx.test.yunshanmeicai.com',
            'dms-sorting'   : 'http://dms-sorting.test.yunshanmeicai.com',
            'wms-center'    : 'http://wms-center.test.yunshanmeicai.com',
            'wms-monitor'   : 'http://wms-monitor2.test.yunshanmeicai.com',
            'omc'           : 'http://omc.test.yunshanmeicai.com',
            'wms-inbound'   : 'http://wms-inbound.test.yunshanmeicai.com',
            'wms-bounding'  : 'http://wms-bounding.test.yunshanmeicai.com'
        };

        function convertTreeData(treeList, newTreeList, authUrlsLib, systemHosts) {
            $.each(treeList, function (i, item) {
                item = convertToMatchSystemHostAndFilterPrivilege(item, authUrlsLib, systemHosts);
                if(item){
                    newTreeList.push(item);
                    if(item.nodes && item.nodes.length > 0){
                        var nodes = [];
                        convertTreeData(item.nodes, nodes, authUrlsLib, systemHosts);
                        item.nodes = nodes;
                    }
                }
            });
        }

        function convertToMatchSystemHostAndFilterPrivilege(node, authUrlsLib, systemHosts) {
            var newHref = '';
            var ref = false;
            if (node.href) {
                var index = node.href.indexOf("/");
                var group = node.href.substring(0, index);
                var url = node.href.substring(index);
                switch (group) {
                    case "pms":
                        newHref = systemHosts['pms'] + url;
                        node.target = '_blank';
                        ref = true;
                        break;
                    case "dms-sorting":
                        newHref = systemHosts['dms-sorting'] + url;
                        ref = true;
                        break;
                    case "wms-center":
                        newHref = systemHosts['wms-center'] + url;
                        ref = true;
                        break;
                    case "wms-monitor":
                        newHref = systemHosts['wms-monitor'] + url;
                        ref = true;
                        break;
                    case "omc":
                        newHref = systemHosts['omc'] + url;
                        ref = true;
                        break;
                    case "wms-inbound":
                        newHref = systemHosts['wms-inbound'] + url;
                        break;
                    case "wms-bounding":
                        newHref = systemHosts['wms-bounding'] + url;
                        break;
                    case '..':
                        if(authUrlsLib['_currentSystem'] && authUrlsLib['_currentSystem'][url]){
                            newHref = node.href;
                        }
                        break;
                    default:
                        break;
                }
                node.href = newHref;
            }
            if(node.text){
                return node;
            }
        }


        /!**
         * @doc 将菜单转换为treeView兼容的数据格式
         * @param menus
         * @param trees
         * @returns {*}
         * @author fanggang
         * @time 2016-12-14 20:01:58 周三
         *!/
        function convertMenuToTree(menus) {
            if (!menus || menus.length === 0) return [];
            var trees = [];
            $.each(menus, function (i, menu) {
                var tree = {
                    text: "",
                    nodeIcon: "",
                    href: "",
                    iconSelected: "",
                    color: "",
                    backgroundColor: "",
                    colorOnHover: "",
                    backgroundColorOnHover: "",
                    selectable: true,
                    state: {
                        selected: false,
                        expanded: true,
                        disabled: false
                    },
                    target: "",                     // 链接打开目标
                    nodes: []
                };

                tree = $.extend(true, {}, tree, menu);
                tree.nodes = convertMenuToTree(menu.nodes);
                trees.push(tree);
            });
            return trees;
        }*/

    });
</script>
</body>
</html>