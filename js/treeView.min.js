!function(a,b,c,d){"use strict";var g,h,e="treeView",f={};f.settings={data:"",getDataUrl:"",nodeIcon:"fa fa-list",nodeIconType:"",iconCollapse:"",iconExpand:"",iconEmpty:"icon-empty",colorOnHover:"",backgroundColorOnHover:"",showIcon:!0,collapseOnIcon:!1,enableLink:!1,enableTopSwitch:!1,topSwitcherTarget:"",enableIndentLeft:!1,indentLeftDelay:1e3,multiSelect:!1,onNodeSelected:d,onNodeCollapsed:d,onNodeExpanded:d,onTopSwitch:d,onTreeIndentLeft:d,some:""},f.options={silent:!1,ignoreChildren:!1},g=function(b,c){return this.$element=a(b),this.init(c),{options:this.options,init:a.proxy(this.init,this),remove:a.proxy(this.remove,this),collapseAll:a.proxy(this.collapseAll,this),collapseNode:a.proxy(this.collapseNode,this),expandAll:a.proxy(this.expandAll,this),expandNode:a.proxy(this.expandNode,this),toggleExpandedState:a.proxy(this.toggleExpandedState,this),selectNode:a.proxy(this.selectNode,this),test:a.proxy(this.test,this)}},g.prototype.init=function(b){this.tree=[],this.nodes=[],b.data&&("string"==typeof b.data&&(b.data=a.parseJSON(b.data)),this.tree=a.extend(!0,[],b.data),delete b.data),this.options=a.extend({},f.settings,b),this.options.enableTopSwitch&&this.options.topSwitcherTarget&&(this.$treeTopTarget=a(this.options.topSwitcherTarget),this.$treeTopTarget&&this.$treeTopTarget.length>0&&(this.enableTopSwitch=!0)),this.options.enableIndentLeft&&(this.enableIndentLeft=!0),this.topExpandNode=d,this.setInitialStates({nodes:this.tree},0),this.render(),this.subscribeEvents()},g.prototype.setInitialStates=function(b,c){var e,f;b.nodes&&(c+=1,e=b,f=this,a.each(b.nodes,function(a,b){b.nodeId=f.nodes.length,b.parentId=e.nodeId,b.nodeIcon=b.nodeIcon||f.options.nodeIcon,b.state=b.state||{},1==c&&b.state.expanded&&f.topExpandNode==d&&(f.topExpandNode=a),f.nodes.push(b),b.nodes&&f.setInitialStates(b,c)}))},g.prototype.subscribeEvents=function(){this.$element.on("click",a.proxy(this.clickHandler,this)),this.enableTopSwitch&&this.$treeTopTarget.on("click",a.proxy(this.switchHandler,this)),"function"==typeof this.options.onNodeSelected&&this.$element.on("nodeSelected",this.options.onNodeSelected),"function"==typeof this.options.onTopSwitch&&this.$element.on("topSwitch",this.options.onTopSwitch),"function"==typeof this.options.onTreeIndentLeft&&this.$element.on("treeIndentLeft",this.options.onTreeIndentLeft)},g.prototype.switchHandler=function(b){var c,d;b.preventDefault(),c=a(b.target),d=this.findNodeDom(c),d&&(d.parent().children().removeClass("active"),d.addClass("active"),this.$treeLeftWrap.children().removeClass("active").eq(d.index()).addClass("active"))},g.prototype.clickHandler=function(b){var c,d,e,g,h,i;this.options.enableLink&&b.preventDefault(),c=a(b.target),d=this.findNodeDom(c),e=this.findNode(d),!e&&this.options.enableIndentLeft&&(g=this.findLapDom(c),g&&this.toggleLap(g,f.options)),e&&!e.state.disabled&&(h=[],i=d.find("i.icon"),i.each(function(b,c){a(c).attr("class")?h=h.concat(a(c).attr("class").split(" ")):null}),a.unique(h),-1!=h.indexOf("node-collapse-expand-icon")?(this.toggleExpandedState(e,f.options),d.toggleClass("collapse")):e.selectable?this.toggleSelectedState(e,f.options):this.toggleExpandedState(e,f.options))},g.prototype.toggleLap=function(a){a&&0!=a.length&&(this.$lapHandle.toggleClass("lapped"),this.$treeLeftWrap.toggleClass("lapped"))},g.prototype.toggleExpandedState=function(a,b){a&&this.setExpandedState(a,!a.state.expanded,b)},g.prototype.setExpandedState=function(b,c,d){c!==b.state.expanded&&(c&&b.nodes?b.state.expanded=!0:c||(b.state.expanded=!1,d.silent||this.$element.trigger("nodeCollapsed",a.extend(!0,{},b)),b.nodes&&!d.ignoreChildren&&a.each(b.nodes,a.proxy(function(a,b){this.setExpandedState(b,!1,d)},this))))},g.prototype.findNode=function(a){var b,c,d;return b=a.attr("data-nodeId")?a:this.findNodeDom(a),c=b.attr("data-nodeId"),d=this.nodes[c],d||console.log("Error: node does not exist"),d},g.prototype.findNodeDom=function(a){var b=a.closest("li.tree-node");return b&&0!=b.length||console.log("Error: nodeDom does not exist"),b},g.prototype.findNodes=function(b,c,d){c=c||"g",d=d||"text";var e=this;return a.grep(this.nodes,function(a){var f=e.getNodeValue(a,d);return"string"==typeof f?f.match(new RegExp(b,c)):void 0})},g.prototype.getNodeValue=function(a,b){var e,f,c=b.indexOf(".");return c>0?(e=a[b.substring(0,c)],f=b.substring(c+1,b.length),this.getNodeValue(e,f)):a.hasOwnProperty(b)?a[b].toString():d},g.prototype.findLapDom=function(a){var b=a.closest(".lap-handle");return b&&0!=b.length?b:(console.log("Error: lapDom does not exist"),null)},g.prototype.getIsExpanded=function(a){return a.state!=d?a.state.expanded!=d&&a.state.expanded:!1},g.prototype.render=function(){this.initialized||(this.$lapHandle="",this.options.enableIndentLeft&&(this.$lapHandle=a(this.template.lapHandle)),this.$treeLeftWrap=a(this.template.treeLeftWrap),this.initialized=!0),this.enableTopSwitch&&(this.$treeTopWrap=a(this.template.treeTopWrap),this.$treeTop=a(this.template.treeTop),this.$treeTopTarget.empty().append(this.$treeTopWrap.empty().append(this.$treeTop.empty())),this.$treeLeftWrap.addClass("switch")),this.$element.empty().append(this.$lapHandle).append(this.$treeLeftWrap.empty()),this.$treeLeftWrap.append(this.buildTree(this.tree,0)),this.$treeLeftWrap.children().eq(this.topExpandNode).addClass("active")},g.prototype.buildTree=function(b,c,d){var e,f;if(b)return c+=1,e=this,e.enableTopSwitch&&c--,d=d||!1,d&&c++,f=1==c?"":a(e.template.treeLeftGroup),d&&(f=a(e.template.treeLeftGroup)),a.each(b,function(b,g){var h,i,j,k,l,m;if(1>=c&&!d?f=a(e.template.treeLeftGroup):null,h=a(e.template.node).attr("data-nodeId",g.nodeId),i=a(e.template.nodeWrap),e.options.enableLink&&(i=a(e.template.nodeLink),i.attr("href",g.href)),0==c)e.options.showIcon&&(j=["node-icon"],j.push(g.nodeIcon||e.options.nodeIcon),i.append(a(e.template.icon).addClass(j.join(" ")))),e.topExpandNode==g.nodeId&&h.addClass("active"),i.append(a(e.template.nodeText).append(g.text)),e.$treeTop.append(h.append(i)),g.nodes&&e.$treeLeftWrap.append(e.buildTree(g.nodes,c,!0));else{if(c>0)for(k=0;c-1>k;k++)i.append(e.template.indent);l=[],g.nodes&&g.nodes.length>0?(l.push("node-collapse-expand-icon"),g.state.expanded?l.push(e.options.iconCollapse):l.push(e.options.iconExpand),i.append(a(e.template.icon).addClass(l.join(" ")))):l.push(e.options.iconEmpty),e.options.showIcon&&(m=["node-icon"],m.push(g.nodeIcon||e.options.nodeIcon),i.append(a(e.template.icon).addClass(m.join(" ")))),i.append(a(e.template.nodeText).append(g.text)),f.append(h.append(i)),g.nodes&&g.nodes.length>0&&g.state.expanded&&!g.state.disabled&&h.append(e.buildTree(g.nodes,c,d)),1!=c||d||(console.log("append treeLeft"),e.$treeLeftWrap.append(f))}}),f},g.prototype.collapseNode=function(){},g.prototype.expandNode=function(){},g.prototype.toggleSelectedState=function(a,b){a&&this.setSelectedState(a,!a.state.selected,b)},g.prototype.setSelectedState=function(b,c,d){c!==b.state.selected&&(c?(this.options.multiSelect||a.each(this.findNodes("true","g","state.selected"),a.proxy(function(a,b){this.setSelectedState(b,!1,d)},this)),b.state.selected=!0,d.silent||this.$element.trigger("nodeSelected",a.extend(!0,{},b))):(b.state.selected=!1,d.silent||this.$element.trigger("nodeUnselected",a.extend(!0,{},b))))},g.prototype.toggleNodeSelected=function(b,c){this.forEachIdentifier(b,c,a.proxy(function(a,b){this.toggleSelectedState(a,b)},this))},g.prototype.forEachIdentifier=function(b,c,d){c=a.extend({},f.options,c),b instanceof Array||(b=[b]),a.each(b,a.proxy(function(a,b){d(this.identifyNode(b),c)},this))},g.prototype.identifyNode=function(a){return"number"==typeof a?this.nodes[a]:a},g.prototype.template={treeTopWrap:'<div class="tree-top-wrap"></div>',treeTop:'<ul class="tree-top-list"></ul>',treeLeftWrap:'<div class="tree-list-wrap"></div>',treeLeftGroupWrap:'<div class="tree-group-wrap"></div>',treeLeftGroup:'<ul class="tree-group"></ul>',nodeWrap:'<span class="node-wrap"></span>',nodeLink:'<a class="node-wrap"></a>',node:'<li class="tree-node"></li>',link:'<a href="javascript:;" class="node-wrap"></a>',nodeText:'<span class="node-text"></span>',indent:'<span class="indent"></span>',icon:'<i class="icon"></i>',badge:'<span class="badge"></span>',lapHandle:'<div class="tree-list-lap"><a href="javascript:" class="lap-handle" id="lapHandle" title="收缩/展开"><i class="fa fa-exchange" aria-hidden="true"></i></a></div>'},g.prototype.getNode=function(a){return this.nodes[a]},g.prototype.getParent=function(a){var b=this.identifyNode(a);return this.nodes[b.parentId]},g.prototype.getNodeListData=function(b,c,d){var g,e=b||"";if(""==e)return null;switch(g=this,c){case"json":a.getJSON(e,function(a){f.settings.data=a,g.init(f,d)});break;case"get":return a.ajax(),null}},h=function(a){b.console&&b.console.error(a)},a.fn[e]=function(b,c){var d;return this.each(function(){var f=a.data(this,e);"string"==typeof b?f?a.isFunction(f[b])&&"_"!==b.charAt(0)?(c instanceof Array||(c=[c]),d=f[b].apply(f,c)):h("No such method : "+b):h("Not initialized, can not call method : "+b):"boolean"==typeof b?d=f:a.data(this,e,new g(this,a.extend(!0,{},b)))}),d||this}}(jQuery,window,document);